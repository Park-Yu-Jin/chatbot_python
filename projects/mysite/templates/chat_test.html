{%load static%}
<!DOCTYPE html>
<html lang="en">
<script type="text/javascript" src="/static/jquery-3.2.1.min.js"></script>
<head>
    <link href="{% static 'css/chatbot.css' %}" rel="stylesheet" type="text/css" />
    <meta charset="UTF-8">
    <link rel="import" href="index.html">
    <title>Title</title>
</head>

<body>
<div class="chat_header">
    <span><img src="{%static 'image/korang.png'%}" height="80" width="100%"></span>
</div>
<div id="divbox" class="chat_content" ></div>

<form id="form" style="display: inline">
    <input type="text" name="input1" class="chat_input" id="input1" size="72" style="display: inline; width: 70%" />
    <input type="button" value="ì „ì†¡" id="btn_submit" class="send_btn" style="display: inline;width: 12%"  />
    
</form>
<form id="form1" style="display: inline">
    <input type="button" name="btn_sound" value="ğŸ¤" id="btn_sound" class="send_btn" style="display: inline;width: 12%"  />
</form>
<script>
    $('#btn_sound').click(function () {
        send1();
    });
    function send1(){
        $('#divbox').append('<div class="msg_box receive"><img class="img" src="{%static '/image/tiger.png'%}"><span>ë…¹ìŒì„ ì‹œì‘í•©ë‹ˆë‹¤ ~<br>5ì´ˆí›„ ì±„íŒ…ì°½ì— ë…¹ìŒëœ ë‚´ìš©ì´ ì…ë ¥ë©ë‹ˆë‹¤.<span></div>');
        $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
        $.ajax({
            url:  'http://127.0.0.1:8000/chat_service/', //ì±—ë´‡ api url
            type: 'post',
            dataType: 'json',
            data: {btn_sound: "ë…¹ìŒ"},
            
            success: function(data) {
                $('#input1').val(data.response);
                send()
            }
        });
    }
</script>
<script>
    $('#divbox').append('<div class="msg_box notice"><span>ğŸ“¢&nbsp;ì±—ë´‡ì˜ ì…ë ¥ í˜•ì‹ì€ ì§€ì—­ê³¼ í‚¤ì›Œë“œ<br>ğŸ“¢&nbsp;(êµìœ¡orì·¨ì—…)ì„ ê¼­ ì…ë ¥í•´ì£¼ì„¸ìš”<span></div>');
    $('#btn_submit').click(function () {
        send();
    });
    $('#form').on('submit', function(e){
       e.preventDefault();
       send();
    });
    $('#close_chat_btn').on('click', function(){
        $('#chat_wrap').hide().empty();
    });
    function send(){
        $('#divbox').append('<div class="msg_box send"><span>'+$('#input1').val()+'<span></div>');
        $("#divbox").scrollTop($("#divbox")[0].scrollHeight);
        $.ajax({
            url:  'http://127.0.0.1:8000/chat_service/', //ì±—ë´‡ api url
            type: 'post',
            dataType: 'json',
            data: $('form').serialize(),
            
            success: function(data) {
                //var a = length(data);
                var a = -1;
                for(var i in data.response){
                    a += 1;
                    if(data.index == "êµìœ¡"){ 
                    $('#divbox').append('<div class="msg_box receive"><img class="img" src="{%static '/image/tiger.png'%}"><span>'+ data.response[a]+data.urls[a]+'<span></div>');
                    if(a+1==data.response.length){
                        $('#divbox').append('<div class="msg_box receive"><img class="img" src="{%static '/image/tiger.png'%}"><span>í›„ê¸°ë¥¼ ì•Œê³ ì‹¶ìœ¼ì‹œë©´ êµìœ¡ê³¼ì • ë²ˆí˜¸ì˜ í›„ê¸°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”<br> ex)1ë²ˆ í›„ê¸° ì•Œë ¤ì¤˜<span></div>');
                    }
                    
                    }
                    else if(data.index == "í›„ê¸°"){ 
                        $('#divbox').append('<div class="msg_box receive"><img class="img" src="{%static '/image/tiger.png'%}"><span>'+ data.response[a]+data.urls[a]+'<span></div>');
                        }
                    else if(data.index == "ì·¨ì—…"){ 
                        $('#divbox').append('<div class="msg_box receive"><img class="img" src="{%static '/image/tiger.png'%}"><span>'+ data.response[a]+data.urls[a]+'<span></div>');
                        }
                    else if(data.index == "ì˜¤ë¥˜"){ 
                        $('#divbox').append('<div class="msg_box receive"><img class="img" src="{%static '/image/tiger.png'%}"><span>'+ data.response[a]+'<span></div>');
                        }
                    
                }
            }
        });
        $('#input1').val('');
    }
</script>
</body>
</html>